"use strict";var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,s=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){a=!0,s=e}finally{try{!n&&o.return&&o.return()}finally{if(a)throw s}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var xImg="/media/innhold/spill/TPR/TTTvind.svg",oImg="/media/innhold/spill/TPR/TTTskip.png";function Title(){return React.createElement("h1",{className:"App-title"},"Turbin pÃ¥ rad")}var App=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"App"},React.createElement(Title,null),React.createElement(Game,null))}}]),t}();function Player(e){return React.createElement("div",{className:"Game-player"},React.createElement("p",{className:"Game-player-score"},e.points),React.createElement("div",{className:"Game-player-button "+(e.isTurn?"isTurn":"")},React.createElement("img",{className:"Game-playerSymbol",src:e.symbol}),React.createElement("select",{onChange:e.onChange},React.createElement("option",{value:"player"},"Spiller"),React.createElement("option",{value:"ai1"},"AI Lett"),React.createElement("option",{value:"ai2"},"AI Middels"),React.createElement("option",{value:"ai3"},"AI Vanskelig"))))}function Square(e){var t=null;return"X"!==e.value&&"O"!==e.value||(t=React.createElement("img",{src:"X"===e.value?xImg:oImg})),React.createElement("button",{className:"Game-square",onClick:e.onClick},t)}var Board=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,React.Component),_createClass(t,[{key:"renderSquare",value:function(e){var t=this;return React.createElement(Square,{value:this.props.squares[e],onClick:function(){return t.props.onClick(e)}})}},{key:"makeWinText",value:function(e){switch(e){default:return"";case"X":return"Vindturbinene vant!";case"O":return"Skipene vant!";case"draw":return"Uavgjort!"}}},{key:"render",value:function(){return React.createElement("div",{className:"Game-board"},this.renderSquare(0),this.renderSquare(1),this.renderSquare(2),this.renderSquare(3),this.renderSquare(4),this.renderSquare(5),this.renderSquare(6),this.renderSquare(7),this.renderSquare(8),React.createElement("div",{className:"Game-result "+(this.props.winner?"show":"")},this.makeWinText(this.props.winner)))}}]),t}(),Game=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.aiTimeout=null,e.state={xAI:null,oAI:null,xPoints:0,oPoints:0,squares:Array(9).fill(null),xIsNext:!0,winner:null,settings:{minAITime:100}},e}return _inherits(t,React.Component),_createClass(t,[{key:"handleClick",value:function(e){this.state.squares[e]||this.state.winner||this.state.xIsNext&&this.state.xAI||!this.state.xIsNext&&this.state.oAI||this.placeSymbol(e)}},{key:"handlePlayerChange",value:function(e,t){if(t)switch(t){default:t=null;break;case"ai1":t=AI.random;break;case"ai2":t=AI.montecarlo;break;case"ai3":t=AI.minimax}e?this.setState({xAI:t}):this.setState({oAI:t}),clearTimeout(this.aiTimeout)}},{key:"placeSymbol",value:function(e){if(!this.state.squares[e]&&!this.state.winner){var t=this.state.squares.slice();t[e]=this.state.xIsNext?"X":"O";var r=calculateWinner(t);r&&console.log(r);var n={squares:t,xIsNext:!this.state.xIsNext,winner:r};"X"===r?n.xPoints=this.state.xPoints+1:"O"===r&&(n.oPoints=this.state.oPoints+1),this.setState(n)}}},{key:"resetGame",value:function(){this.setState({squares:Array(9).fill(null),xIsNext:!0,winner:null})}},{key:"componentDidUpdate",value:function(){var e=this;if(this.state.winner)setTimeout(function(){return e.resetGame()},1500);else{if(this.state.xIsNext&&this.state.xAI){var t=this.state.xAI(this.state.squares,"X");this.aiTimeout=setTimeout(function(){return e.placeSymbol(t)},this.state.settings.minAITime)}if(!this.state.xIsNext&&this.state.oAI){var r=this.state.oAI(this.state.squares,"O");this.aiTimeout=setTimeout(function(){return e.placeSymbol(r)},this.state.settings.minAITime)}}}},{key:"render",value:function(){var e=this;return React.createElement("div",{className:"Game"},React.createElement("div",{className:"Game-players"},React.createElement(Player,{symbol:xImg,points:this.state.xPoints,isTurn:this.state.xIsNext,onChange:function(t){return e.handlePlayerChange(!0,t.target.value)}}),React.createElement("span",null,"vs"),React.createElement(Player,{symbol:oImg,points:this.state.oPoints,isTurn:!this.state.xIsNext,onChange:function(t){return e.handlePlayerChange(!1,t.target.value)}})),React.createElement(Board,{squares:this.state.squares,onClick:function(t){return e.handleClick(t)},winner:this.state.winner}))}}]),t}();function calculateWinner(e){for(var t=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],r=0;r<t.length;r++){var n=_slicedToArray(t[r],3),a=n[0],s=n[1],i=n[2];if(e[a]&&e[a]===e[s]&&e[s]===e[i])return e[a]}var o=!0,u=!1,l=void 0;try{for(var c,h=e[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){if(null===c.value)return null}}catch(e){u=!0,l=e}finally{try{!o&&h.return&&h.return()}finally{if(u)throw l}}return"draw"}var MCTRIALS=1e3,MCSCORECURRENT=1,MCSCOREOTHER=1,AIBoard=function(){function e(t){_classCallCheck(this,e),this.squares=t.slice(),this.dim=3}return _createClass(e,[{key:"square",value:function(e,t){return this.squares[toSquareNum([e,t])]}},{key:"clone",value:function(){var t=void 0;return t=new e(this.squares),t}},{key:"move",value:function(e,t){return!this.squares[toSquareNum(e)]&&(this.squares[toSquareNum(e)]=t,!0)}},{key:"getEmptySquares",value:function(){for(var e=[],t=0;t<this.squares.length;t++)this.squares[t]||e.push(t);return toCoords(e)}},{key:"checkWin",value:function(){for(var e=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],t=0;t<e.length;t++){var r=_slicedToArray(e[t],3),n=r[0],a=r[1],s=r[2];if(this.squares[n]&&this.squares[n]===this.squares[a]&&this.squares[a]===this.squares[s])return this.squares[n]}var i=!0,o=!1,u=void 0;try{for(var l,c=this.squares[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){if(null===l.value)return null}}catch(e){o=!0,u=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw u}}return"draw"}}]),e}(),AI=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"random",value:function(e,t){var r=new AIBoard(e).getEmptySquares();return toSquareNum(r[Math.floor(Math.random()*r.length)])}},{key:"minimax",value:function(e,t){return toSquareNum(mmMove(new AIBoard(e),t)[1])}},{key:"montecarlo",value:function(e,t){return toSquareNum(mcMove(new AIBoard(e),t,MCTRIALS))}}]),e}();function toCoords(e){var t=[],r=!0,n=!1,a=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var o=s.value;t.push(toCoord(o))}}catch(e){n=!0,a=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw a}}return t}function toCoord(e){return[Math.floor(e/3),e%3]}function toSquareNums(e){var t=[],r=!0,n=!1,a=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var o=s.value;t.push(toSquareNum(o))}}catch(e){n=!0,a=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw a}}return t}function toSquareNum(e){return 3*e[0]+e[1]}function toScore(e){return"X"===e?1:"O"===e?-1:0}function mmMove(e,t){var r,n,a,s,i,o,u;if(u=[],9===(a=e.getEmptySquares()).length)for(o=0;o<9;o++)u[o]=[0,a[o]];else{if(e.checkWin())return[toScore(e.checkWin()),[-1,-1]];for(r=[],n=toScore(t),o=0;o<a.length;o++){if((s=e.clone()).move(a[o],t),(i=mmMove(s,"X"===t?"O":"X")[0])===n)return[i,a[o]];r.push([i,a[o]])}for(o=0;o<r.length;o++)r[o][0]===toScore(void 0)&&u.push(r[o]);0===u.length&&(u=r)}var l=Math.floor(Math.random()*u.length);return[u[l][0],u[l][1]]}function getEmptyBoard(e,t){return Array(e).fill(Array(e).fill(t))}function mcTrial(e,t){for(var r=e.getEmptySquares();!e.checkWin();){var n=r[Math.floor(Math.random()*r.length)];e.move(n,t),t="X"===t?"O":"X",r=e.getEmptySquares()}return e}function mcUpdateScores(e,t,r){for(var n=t.checkWin(),a=getEmptyBoard(t.dim,0),s=0;s<t.dim;s++)for(var i=0;i<t.dim;i++)"draw"===n?a[s][i]=0:n===r?t.square(s,i)?t.square(s,i)===r?a[s][i]=MCSCORECURRENT:a[s][i]=-MCSCOREOTHER:a[s][i]=0:t.square(s,i)?t.square(s,i)===r?a[s][i]=-MCSCORECURRENT:a[s][i]=MCSCOREOTHER:a[s][i]=0;for(var o=0;o<t.dim;o++)for(;o<t.dim;o++)e[o][0]+=a[o][0]}function getBestMove(e,t){var r=e.getEmptySquares();if(0!==r){var n=null,a=[],s=!0,i=!1,o=void 0;try{for(var u,l=r[Symbol.iterator]();!(s=(u=l.next()).done);s=!0){var c=u.value,h=t[c[0]][c[1]];null===n?(n=h,a.push(c)):n<h?(n=h,(a=[]).push(c)):n===h&&a.push(c)}}catch(e){i=!0,o=e}finally{try{!s&&l.return&&l.return()}finally{if(i)throw o}}return a[Math.floor(Math.random()*a.length)]}console.log("Error: the board is full, so there is no best move")}function mcMove(e,t,r){for(var n=getEmptyBoard(e.dim,0),a=0;a<r;a++){var s=e.clone();mcUpdateScores(n,s=mcTrial(s,t),t)}return getBestMove(e,n)}var domContainer=document.querySelector("#gameArea");ReactDOM.render(React.createElement(App,null),domContainer);